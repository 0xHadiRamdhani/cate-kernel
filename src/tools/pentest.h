#ifndef PENTEST_H
#define PENTEST_H

#include <stdint.h>
#include <stdbool.h>
#include <stddef.h>

/* Pentest tool types */
typedef enum {
    PENTEST_TOOL_SCANNER = 1,
    PENTEST_TOOL_SNIFFER = 2,
    PENTEST_TOOL_SPOOFER = 3,
    PENTEST_TOOL_INJECTOR = 4,
    PENTEST_TOOL_CRACKER = 5,
    PENTEST_TOOL_EXPLOITER = 6,
    PENTEST_TOOL_FORENSICS = 7,
    PENTEST_TOOL_ANALYZER = 8,
    PENTEST_TOOL_GENERATOR = 9,
    PENTEST_TOOL_FUZZER = 10,
    PENTEST_TOOL_PROXY = 11,
    PENTEST_TOOL_TUNNEL = 12,
    PENTEST_TOOL_BACKDOOR = 13,
    PENTEST_TOOL_ROOTKIT = 14,
    PENTEST_TOOL_KEYLOGGER = 15,
    PENTEST_TOOL_SCREENSHOT = 16,
    PENTEST_TOOL_WEB = 17,
    PENTEST_TOOL_NETWORK = 18,
    PENTEST_TOOL_WIRELESS = 19,
    PENTEST_TOOL_BLUETOOTH = 20,
    PENTEST_TOOL_HARDWARE = 21
} pentest_tool_type_t;

/* Pentest scan types */
typedef enum {
    PENTEST_SCAN_PORT = 1,
    PENTEST_SCAN_VULNERABILITY = 2,
    PENTEST_SCAN_WEB = 3,
    PENTEST_SCAN_NETWORK = 4,
    PENTEST_SCAN_WIRELESS = 5,
    PENTEST_SCAN_BLUETOOTH = 6,
    PENTEST_SCAN_SERVICE = 7,
    PENTEST_SCAN_OS = 8,
    PENTEST_SCAN_APPLICATION = 9,
    PENTEST_SCAN_DATABASE = 10,
    PENTEST_SCAN_SSL = 11,
    PENTEST_SCAN_DNS = 12,
    PENTEST_SCAN_SMB = 13,
    PENTEST_SCAN_SSH = 14,
    PENTEST_SCAN_FTP = 15,
    PENTEST_SCAN_HTTP = 16,
    PENTEST_SCAN_HTTPS = 17
} pentest_scan_type_t;

/* Pentest attack types */
typedef enum {
    PENTEST_ATTACK_DOS = 1,
    PENTEST_ATTACK_DDOS = 2,
    PENTEST_ATTACK_MITM = 3,
    PENTEST_ATTACK_SPOOFING = 4,
    PENTEST_ATTACK_INJECTION = 5,
    PENTEST_ATTACK_BUFFER_OVERFLOW = 6,
    PENTEST_ATTACK_SQL_INJECTION = 7,
    PENTEST_ATTACK_XSS = 8,
    PENTEST_ATTACK_CSRF = 9,
    PENTEST_ATTACK_DIRECTORY_TRAVERSAL = 10,
    PENTEST_ATTACK_COMMAND_INJECTION = 11,
    PENTEST_ATTACK_CODE_INJECTION = 12,
    PENTEST_ATTACK_FILE_INCLUSION = 13,
    PENTEST_ATTACK_SESSION_HIJACKING = 14,
    PENTEST_ATTACK_PASSWORD_CRACKING = 15,
    PENTEST_ATTACK_BRUTE_FORCE = 16,
    PENTEST_ATTACK_DICTIONARY = 17,
    PENTEST_ATTACK_RAINBOW_TABLE = 18,
    PENTEST_ATTACK_SOCIAL_ENGINEERING = 19,
    PENTEST_ATTACK_PHISHING = 20
} pentest_attack_type_t;

/* Pentest exploit types */
typedef enum {
    PENTEST_EXPLOIT_REMOTE = 1,
    PENTEST_EXPLOIT_LOCAL = 2,
    PENTEST_EXPLOIT_CLIENT_SIDE = 3,
    PENTEST_EXPLOIT_WEB = 4,
    PENTEST_EXPLOIT_NETWORK = 5,
    PENTEST_EXPLOIT_WIRELESS = 6,
    PENTEST_EXPLOIT_HARDWARE = 7,
    PENTEST_EXPLOIT_PHYSICAL = 8,
    PENTEST_EXPLOIT_SOCIAL = 9
} pentest_exploit_type_t;

/* Pentest payload types */
typedef enum {
    PENTEST_PAYLOAD_SHELL = 1,
    PENTEST_PAYLOAD_METERPRETER = 2,
    PENTEST_PAYLOAD_VNC = 3,
    PENTEST_PAYLOAD_COMMAND = 4,
    PENTEST_PAYLOAD_DOWNLOAD = 5,
    PENTEST_PAYLOAD_UPLOAD = 6,
    PENTEST_PAYLOAD_KEYLOGGER = 7,
    PENTEST_PAYLOAD_SCREENSHOT = 8,
    PENTEST_PAYLOAD_WEBCAM = 9,
    PENTEST_PAYLOAD_MICROPHONE = 10,
    PENTEST_PAYLOAD_BACKDOOR = 11,
    PENTEST_PAYLOAD_ROOTKIT = 12,
    PENTEST_PAYLOAD_TROJAN = 13,
    PENTEST_PAYLOAD_WORM = 14,
    PENTEST_PAYLOAD_VIRUS = 15,
    PENTEST_PAYLOAD_RANSOMWARE = 16,
    PENTEST_PAYLOAD_CRYPTOMINER = 17
} pentest_payload_type_t;

/* Pentest status codes */
typedef enum {
    PENTEST_STATUS_OK = 0,
    PENTEST_STATUS_ERROR = -1,
    PENTEST_STATUS_TIMEOUT = -2,
    PENTEST_STATUS_INVALID_PARAM = -3,
    PENTEST_STATUS_NO_MEMORY = -4,
    PENTEST_STATUS_NOT_FOUND = -5,
    PENTEST_STATUS_ACCESS_DENIED = -6,
    PENTEST_STATUS_PERMISSION_DENIED = -7,
    PENTEST_STATUS_TARGET_DOWN = -8,
    PENTEST_STATUS_TARGET_PROTECTED = -9,
    PENTEST_STATUS_EXPLOIT_FAILED = -10,
    PENTEST_STATUS_PAYLOAD_FAILED = -11,
    PENTEST_STATUS_SCAN_INCOMPLETE = -12,
    PENTEST_STATUS_VULNERABILITY_NOT_FOUND = -13,
    PENTEST_STATUS_SERVICE_NOT_FOUND = -14,
    PENTEST_STATUS_PORT_CLOSED = -15,
    PENTEST_STATUS_FIREWALL_BLOCKED = -16,
    PENTEST_STATUS_IDS_DETECTED = -17,
    PENTEST_STATUS_RATE_LIMITED = -18,
    PENTEST_STATUS_AUTHENTICATION_FAILED = -19,
    PENTEST_STATUS_AUTHORIZATION_FAILED = -20
} pentest_status_t;

/* Pentest target information */
typedef struct {
    uint32_t target_id;
    char name[64];
    char ip_address[64];
    uint32_t ip_int;
    char mac_address[32];
    uint8_t mac_bytes[6];
    char hostname[128];
    char description[256];
    uint32_t open_ports[1024];
    uint32_t open_port_count;
    uint32_t services[256];
    uint32_t service_count;
    char operating_system[64];
    char version[64];
    char architecture[32];
    uint32_t vulnerabilities[256];
    uint32_t vulnerability_count;
    bool alive;
    bool reachable;
    uint32_t response_time;
    uint32_t hop_count;
    uint8_t threat_level;
    bool critical;
    bool exploited;
    bool compromised;
    uint64_t discovered_time;
    uint64_t last_scan;
    uint64_t last_exploit;
    uint32_t exploit_count;
    uint32_t scan_count;
    uint32_t flags;
} pentest_target_t;

/* Pentest scan result */
typedef struct {
    uint32_t scan_id;
    uint32_t target_id;
    pentest_scan_type_t scan_type;
    uint16_t start_port;
    uint16_t end_port;
    uint32_t open_ports[1024];
    uint32_t open_port_count;
    uint32_t closed_ports;
    uint32_t filtered_ports;
    uint32_t services[256];
    uint32_t service_count;
    uint32_t vulnerabilities[256];
    uint32_t vulnerability_count;
    uint64_t start_time;
    uint64_t end_time;
    uint32_t duration;
    uint32_t packets_sent;
    uint32_t packets_received;
    uint64_t bytes_sent;
    uint64_t bytes_received;
    pentest_status_t status;
    char summary[512];
    uint32_t flags;
} pentest_scan_result_t;

/* Pentest vulnerability information */
typedef struct {
    uint32_t vulnerability_id;
    char name[128];
    char description[512];
    char cve_id[32];
    char cvss_score[16];
    float severity;
    uint8_t threat_level;
    pentest_attack_type_t attack_type;
    char affected_versions[256];
    char fixed_versions[256];
    char exploit_reference[256];
    char patch_reference[256];
    bool exploit_available;
    bool patch_available;
    bool verified;
    bool confirmed;
    uint32_t exploit_id;
    uint32_t target_count;
    uint64_t discovered_time;
    uint64_t verified_time;
    uint32_t flags;
} pentest_vulnerability_t;

/* Pentest exploit information */
typedef struct {
    uint32_t exploit_id;
    char name[128];
    char description[512];
    pentest_exploit_type_t exploit_type;
    pentest_payload_type_t payload_type;
    char target_platform[64];
    char target_architecture[32];
    char target_service[64];
    uint32_t target_port;
    char author[128];
    char reference[256];
    uint8_t code[4096];
    uint32_t code_size;
    uint8_t payload[2048];
    uint32_t payload_size;
    bool verified;
    bool reliable;
    uint32_t success_rate;
    uint32_t reliability;
    uint64_t created_time;
    uint64_t verified_time;
    uint32_t usage_count;
    uint32_t success_count;
    uint32_t flags;
} pentest_exploit_t;

/* Pentest tool structure */
typedef struct pentest_tool {
    uint32_t tool_id;
    char name[64];
    char description[256];
    pentest_tool_type_t tool_type;
    char version[32];
    char author[128];
    char category[64];
    bool enabled;
    bool running;
    uint32_t priority;
    uint64_t start_time;
    uint64_t end_time;
    uint32_t target_count;
    uint32_t success_count;
    uint32_t failure_count;
    uint32_t error_count;
    
    /* Tool operations */
    pentest_status_t (*init)(struct pentest_tool* tool);
    pentest_status_t (*cleanup)(struct pentest_tool* tool);
    pentest_status_t (*start)(struct pentest_tool* tool);
    pentest_status_t (*stop)(struct pentest_tool* tool);
    pentest_status_t (*pause)(struct pentest_tool* tool);
    pentest_status_t (*resume)(struct pentest_tool* tool);
    pentest_status_t (*configure)(struct pentest_tool* tool, void* config);
    pentest_status_t (*get_status)(struct pentest_tool* tool, void* status);
    
    /* Tool specific data */
    void* private_data;
    uint32_t private_data_size;
    
    /* Statistics */
    uint64_t total_runtime;
    uint64_t total_targets;
    uint64_t total_successes;
    uint64_t total_failures;
    uint64_t total_errors;
    uint64_t total_bytes_processed;
    uint32_t average_speed;
    uint32_t peak_speed;
    
    /* Security features */
    bool stealth_mode;
    bool evasion_mode;
    bool encryption_enabled;
    bool authentication_required;
    uint8_t security_level;
    uint8_t encryption_key[32];
    
    /* Linked list */
    struct pentest_tool* next;
} pentest_tool_t;

/* Pentest session structure */
typedef struct {
    uint32_t session_id;
    char name[128];
    char description[512];
    uint32_t target_count;
    pentest_target_t* targets;
    uint32_t tool_count;
    pentest_tool_t* tools;
    uint32_t scan_count;
    pentest_scan_result_t* scans;
    uint32_t vulnerability_count;
    pentest_vulnerability_t* vulnerabilities;
    uint32_t exploit_count;
    pentest_exploit_t* exploits;
    uint64_t start_time;
    uint64_t end_time;
    uint32_t duration;
    uint32_t flags;
    uint8_t threat_level;
    bool active;
    bool completed;
    bool compromised;
    uint32_t success_rate;
    uint32_t coverage;
    char report_file[256];
    char log_file[256];
} pentest_session_t;

/* Pentest manager structure */
typedef struct {
    pentest_tool_t* tools;
    uint32_t tool_count;
    pentest_session_t* sessions;
    uint32_t session_count;
    pentest_target_t* targets;
    uint32_t target_count;
    pentest_vulnerability_t* vulnerabilities;
    uint32_t vulnerability_count;
    pentest_exploit_t* exploits;
    uint32_t exploit_count;
    bool initialized;
    
    /* Configuration */
    uint32_t max_concurrent_tools;
    uint32_t max_concurrent_sessions;
    uint32_t default_timeout;
    uint32_t default_threads;
    uint32_t default_retries;
    uint8_t default_threat_level;
    bool stealth_mode;
    bool evasion_mode;
    bool encryption_enabled;
    bool logging_enabled;
    bool reporting_enabled;
    
    /* Statistics */
    uint64_t total_sessions;
    uint64_t total_targets;
    uint64_t total_vulnerabilities;
    uint64_t total_exploits;
    uint64_t total_scans;
    uint64_t total_attacks;
    uint64_t total_successes;
    uint64_t total_failures;
    uint64_t total_runtime;
    
    /* Security */
    uint8_t security_level;
    bool authentication_required;
    bool authorization_required;
    bool audit_enabled;
    
    /* Pentesting modes */
    bool reconnaissance_mode;
    bool scanning_mode;
    bool exploitation_mode;
    bool post_exploitation_mode;
    bool reporting_mode;
    
    /* Current session */
    uint32_t current_session_id;
    pentest_session_t* current_session;
    
} pentest_manager_t;

/* Pentest tool functions */
void pentest_init(void);
void pentest_shutdown(void);
bool pentest_is_initialized(void);

/* Tool management */
pentest_tool_t* pentest_create_tool(pentest_tool_type_t tool_type, const char* name, const char* description);
pentest_status_t pentest_destroy_tool(pentest_tool_t* tool);
pentest_tool_t* pentest_get_tool(uint32_t tool_id);
pentest_tool_t* pentest_get_tool_by_name(const char* name);
uint32_t pentest_get_tool_count(void);
pentest_status_t pentest_register_tool(pentest_tool_t* tool);
pentest_status_t pentest_unregister_tool(uint32_t tool_id);

/* Session management */
pentest_session_t* pentest_create_session(const char* name, const char* description);
pentest_status_t pentest_destroy_session(pentest_session_t* session);
pentest_session_t* pentest_get_session(uint32_t session_id);
pentest_session_t* pentest_get_current_session(void);
uint32_t pentest_get_session_count(void);
pentest_status_t pentest_start_session(pentest_session_t* session);
pentest_status_t pentest_stop_session(pentest_session_t* session);
pentest_status_t pentest_pause_session(pentest_session_t* session);
pentest_status_t pentest_resume_session(pentest_session_t* session);

/* Target management */
pentest_target_t* pentest_create_target(const char* name, const char* ip_address);
pentest_status_t pentest_destroy_target(pentest_target_t* target);
pentest_target_t* pentest_get_target(uint32_t target_id);
pentest_target_t* pentest_get_target_by_ip(const char* ip_address);
uint32_t pentest_get_target_count(void);
pentest_status_t pentest_add_target_to_session(pentest_session_t* session, pentest_target_t* target);
pentest_status_t pentest_remove_target_from_session(pentest_session_t* session, pentest_target_t* target);

/* Scanning functions */
pentest_status_t pentest_start_port_scan(pentest_session_t* session, pentest_target_t* target, uint16_t start_port, uint16_t end_port);
pentest_status_t pentest_start_vulnerability_scan(pentest_session_t* session, pentest_target_t* target);
pentest_status_t pentest_start_service_scan(pentest_session_t* session, pentest_target_t* target);
pentest_status_t pentest_start_os_scan(pentest_session_t* session, pentest_target_t* target);
pentest_status_t pentest_start_web_scan(pentest_session_t* session, pentest_target_t* target);
pentest_status_t pentest_start_ssl_scan(pentest_session_t* session, pentest_target_t* target);
pentest_status_t pentest_stop_scan(pentest_session_t* session);

/* Exploitation functions */
pentest_status_t pentest_start_exploitation(pentest_session_t* session, pentest_target_t* target, pentest_vulnerability_t* vulnerability);
pentest_status_t pentest_stop_exploitation(pentest_session_t* session);
pentest_status_t pentest_select_exploit(pentest_session_t* session, pentest_exploit_t* exploit);
pentest_status_t pentest_configure_payload(pentest_session_t* session, pentest_payload_type_t payload_type);
pentest_status_t pentest_execute_exploit(pentest_session_t* session);

/* Vulnerability management */
pentest_vulnerability_t* pentest_create_vulnerability(const char* name, const char* description, float severity);
pentest_status_t pentest_destroy_vulnerability(pentest_vulnerability_t* vulnerability);
pentest_vulnerability_t* pentest_get_vulnerability(uint32_t vulnerability_id);
pentest_vulnerability_t* pentest_get_vulnerability_by_cve(const char* cve_id);
uint32_t pentest_get_vulnerability_count(void);
pentest_status_t pentest_add_vulnerability_to_target(pentest_target_t* target, pentest_vulnerability_t* vulnerability);
pentest_status_t pentest_remove_vulnerability_from_target(pentest_target_t* target, pentest_vulnerability_t* vulnerability);

/* Exploit management */
pentest_exploit_t* pentest_create_exploit(const char* name, const char* description, pentest_exploit_type_t exploit_type);
pentest_status_t pentest_destroy_exploit(pentest_exploit_t* exploit);
pentest_exploit_t* pentest_get_exploit(uint32_t exploit_id);
pentest_exploit_t* pentest_get_exploit_by_name(const char* name);
uint32_t pentest_get_exploit_count(void);
pentest_status_t pentest_verify_exploit(pentest_exploit_t* exploit);
pentest_status_t pentest_test_exploit(pentest_exploit_t* exploit);

/* Reporting functions */
pentest_status_t pentest_generate_report(pentest_session_t* session, const char* filename);
pentest_status_t pentest_export_results(pentest_session_t* session, const char* format);
pentest_status_t pentest_import_results(pentest_session_t* session, const char* filename);
pentest_status_t pentest_save_session(pentest_session_t* session, const char* filename);
pentest_status_t pentest_load_session(pentest_session_t* session, const char* filename);

/* Utility functions */
pentest_status_t pentest_set_stealth_mode(bool enable);
pentest_status_t pentest_set_evasion_mode(bool enable);
pentest_status_t pentest_set_encryption(bool enable);
pentest_status_t pentest_set_security_level(uint8_t level);
pentest_status_t pentest_configure_timeout(uint32_t timeout);
pentest_status_t pentest_configure_threads(uint32_t threads);
pentest_status_t pentest_configure_retries(uint32_t retries);
bool pentest_is_stealth_mode_enabled(void);
bool pentest_is_evasion_mode_enabled(void);
uint8_t pentest_get_security_level(void);

/* Statistics */
void pentest_get_statistics(uint64_t* total_sessions, uint64_t* total_targets, uint64_t* total_vulnerabilities, uint64_t* total_exploits);
void pentest_get_session_statistics(pentest_session_t* session, uint32_t* target_count, uint32_t* vulnerability_count, uint32_t* exploit_count);
void pentest_get_tool_statistics(pentest_tool_t* tool, uint64_t* total_runtime, uint64_t* total_targets, uint64_t* total_successes);
void pentest_reset_statistics(void);

/* Advanced features */
pentest_status_t pentest_start_reconnaissance(pentest_session_t* session);
pentest_status_t pentest_start_exploitation_phase(pentest_session_t* session);
pentest_status_t pentest_start_post_exploitation(pentest_session_t* session);
pentest_status_t pentest_start_reporting_phase(pentest_session_t* session);
pentest_status_t pentest_automate_session(pentest_session_t* session);
pentest_status_t pentest_schedule_scan(pentest_session_t* session, uint64_t schedule_time);
pentest_status_t pentest_monitor_targets(pentest_session_t* session);

/* Pentesting modes */
pentest_status_t pentest_enable_reconnaissance_mode(void);
pentest_status_t pentest_disable_reconnaissance_mode(void);
pentest_status_t pentest_enable_scanning_mode(void);
pentest_status_t pentest_disable_scanning_mode(void);
pentest_status_t pentest_enable_exploitation_mode(void);
pentest_status_t pentest_disable_exploitation_mode(void);
pentest_status_t pentest_enable_post_exploitation_mode(void);
pentest_status_t pentest_disable_post_exploitation_mode(void);
pentest_status_t pentest_enable_reporting_mode(void);
pentest_status_t pentest_disable_reporting_mode(void);
bool pentest_is_reconnaissance_mode_enabled(void);
bool pentest_is_scanning_mode_enabled(void);
bool pentest_is_exploitation_mode_enabled(void);
bool pentest_is_post_exploitation_mode_enabled(void);
bool pentest_is_reporting_mode_enabled(void);

/* Global pentest manager */
extern pentest_manager_t* global_pentest_manager;

/* Pentesting constants */
#define PENTEST_MAX_SESSIONS            16
#define PENTEST_MAX_TARGETS             1024
#define PENTEST_MAX_VULNERABILITIES     4096
#define PENTEST_MAX_EXPLOITS            2048
#define PENTEST_MAX_TOOLS               256
#define PENTEST_MAX_SCAN_RESULTS        10000
#define PENTEST_MAX_CONCURRENT_TOOLS    8
#define PENTEST_MAX_CONCURRENT_SESSIONS 4

#define PENTEST_DEFAULT_TIMEOUT         30000  /* 30 seconds */
#define PENTEST_DEFAULT_THREADS         4
#define PENTEST_DEFAULT_RETRIES         3
#define PENTEST_DEFAULT_THREAT_LEVEL    3

#define PENTEST_STEALTH_LEVEL_LOW       1
#define PENTEST_STEALTH_LEVEL_MEDIUM    2
#define PENTEST_STEALTH_LEVEL_HIGH      3
#define PENTEST_STEALTH_LEVEL_MAXIMUM   4

#define PENTEST_EVASION_LEVEL_LOW       1
#define PENTEST_EVASION_LEVEL_MEDIUM    2
#define PENTEST_EVASION_LEVEL_HIGH      3
#define PENTEST_EVASION_LEVEL_MAXIMUM   4

/* Common ports for pentesting */
#define PENTEST_PORT_HTTP               80
#define PENTEST_PORT_HTTPS              443
#define PENTEST_PORT_FTP                21
#define PENTEST_PORT_SSH                22
#define PENTEST_PORT_TELNET             23
#define PENTEST_PORT_SMTP               25
#define PENTEST_PORT_DNS                53
#define PENTEST_PORT_HTTP_ALT            8080
#define PENTEST_PORT_HTTPS_ALT           8443
#define PENTEST_PORT_MYSQL              3306
#define PENTEST_PORT_POSTGRESQL         5432
#define PENTEST_PORT_MONGODB             27017
#define PENTEST_PORT_REDIS               6379
#define PENTEST_PORT_MEMCACHED           11211
#define PENTEST_PORT_ELASTICSEARCH       9200
#define PENTEST_PORT_KIBANA              5601
#define PENTEST_PORT_LOGSTASH            5044

/* Common vulnerabilities */
#define PENTEST_VULN_SQL_INJECTION        1
#define PENTEST_VULN_XSS                  2
#define PENTEST_VULN_BUFFER_OVERFLOW      3
#define PENTEST_VULN_DIRECTORY_TRAVERSAL  4
#define PENTEST_VULN_COMMAND_INJECTION    5
#define PENTEST_VULN_FILE_INCLUSION       6
#define PENTEST_VULN_CSRF                 7
#define PENTEST_VULN_AUTHENTICATION       8
#define PENTEST_VULN_AUTHORIZATION        9
#define PENTEST_VULN_SESSION_MANAGEMENT   10
#define PENTEST_VULN_CRYPTOGAPHY          11
#define PENTEST_VULN_CONFIGURATION        12
#define PENTEST_VULN_INFORMATION_DISCLOSURE 13

#endif /* PENTEST_H */