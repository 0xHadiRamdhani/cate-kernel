# GRUB2 configuration for bootloader testing

set timeout=5
set default=0

# Set graphics mode
set gfxmode=1024x768
set gfxpayload=keep
insmod all_video
insmod gfxterm
terminal_output gfxterm

# Set colors
set color_normal=white/black
set color_highlight=black/white

# Menu entry for our bootloader
menuentry "Kernel OS Pentester - Multiboot2 Bootloader" {
    multiboot2 /boot/bootloader.bin
    module /boot/exploit.mod "Exploit Module" 
    module /boot/scanner.mod "Scanner Module"
    module /boot/network.mod "Network Module"
    module /boot/forensics.mod "Forensics Module"
    boot
}

# Menu entry for testing with serial output
menuentry "Kernel OS Pentester - Debug Mode" {
    multiboot2 /boot/bootloader.bin
    module /boot/exploit.mod "Exploit Module"
    module /boot/scanner.mod "Scanner Module" 
    module /boot/network.mod "Network Module"
    module /boot/forensics.mod "Forensics Module"
    set gfxpayload=text
    boot
}

# Menu entry for memory testing
menuentry "Kernel OS Pentester - Memory Test" {
    multiboot2 /boot/bootloader.bin
    module /boot/memtest.mod "Memory Test Module"
    boot
}

# Menu entry for ACPI testing
menuentry "Kernel OS Pentester - ACPI Test" {
    multiboot2 /boot/bootloader.bin
    module /boot/acpi.mod "ACPI Test Module"
    boot
}

# Menu entry for EFI testing
menuentry "Kernel OS Pentester - EFI Test" {
    multiboot2 /boot/bootloader.bin
    module /boot/efi.mod "EFI Test Module"
    boot
}

# Fallback entry for recovery
menuentry "Recovery Mode" {
    multiboot2 /boot/bootloader.bin
    set gfxpayload=text
    boot
}

# Advanced options submenu
submenu "Advanced Options" {
    menuentry "Boot with serial console" {
        multiboot2 /boot/bootloader.bin
        module /boot/serial.mod "Serial Console Module"
        set gfxpayload=text
        boot
    }
    
    menuentry "Boot with network support" {
        multiboot2 /boot/bootloader.bin
        module /boot/network.mod "Network Module"
        module /boot/netstack.mod "Network Stack Module"
        boot
    }
    
    menuentry "Boot with forensics tools" {
        multiboot2 /boot/bootloader.bin
        module /boot/forensics.mod "Forensics Module"
        module /boot/memory.mod "Memory Analysis Module"
        boot
    }
    
    menuentry "Boot with all modules" {
        multiboot2 /boot/bootloader.bin
        module /boot/exploit.mod "Exploit Module"
        module /boot/scanner.mod "Scanner Module"
        module /boot/network.mod "Network Module"
        module /boot/forensics.mod "Forensics Module"
        module /boot/crypto.mod "Crypto Module"
        module /boot/misc.mod "Misc Module"
        boot
    }
}

# Security options submenu
submenu "Security Options" {
    menuentry "Boot with security checks" {
        multiboot2 /boot/bootloader.bin
        module /boot/security.mod "Security Module"
        boot
    }
    
    menuentry "Boot with stack protection" {
        multiboot2 /boot/bootloader.bin
        module /boot/stack.mod "Stack Protection Module"
        boot
    }
    
    menuentry "Boot with memory protection" {
        multiboot2 /boot/bootloader.bin
        module /boot/mprotect.mod "Memory Protection Module"
        boot
    }
}

# Debug options submenu
submenu "Debug Options" {
    menuentry "Boot with debug output" {
        multiboot2 /boot/bootloader.bin
        module /boot/debug.mod "Debug Module"
        set gfxpayload=text
        boot
    }
    
    menuentry "Boot with memory map" {
        multiboot2 /boot/bootloader.bin
        module /boot/mmap.mod "Memory Map Module"
        boot
    }
    
    menuentry "Boot with ACPI debug" {
        multiboot2 /boot/bootloader.bin
        module /boot/acpi-debug.mod "ACPI Debug Module"
        boot
    }
}

# Emergency shell
menuentry "Emergency Shell" {
    multiboot2 /boot/bootloader.bin
    module /boot/shell.mod "Emergency Shell Module"
    set gfxpayload=text
    boot
}

# Default boot if no selection
if [ "${timeout}" = 0 ]; then
    set timeout=5
fi

# Boot message
echo "Kernel OS Pentester Bootloader - Multiboot2 Compliant"
echo "Version 1.0 - Security Enhanced Bootloader"
echo "Press any key to show boot menu..."